package com.ardublock.translator.block;

import com.ardublock.translator.Translator;
import com.ardublock.translator.block.exception.SocketNullException;
import com.ardublock.translator.block.exception.SubroutineNotDeclaredException;

public class ForBlock extends TranslatorBlock {
	public ForBlock(Long blockId, Translator translator, String codePrefix,
			String codeSuffix, String label) {
		super(blockId, translator, codePrefix, codeSuffix, label);
	}

	@Override
	public String toCode() throws SocketNullException,
			SubroutineNotDeclaredException {

		String tempInit = getTranslatorBlockAtSocket(0).toCode();
		System.out.println("tempInit is" + tempInit);
		String init = new String("");
		for (int i = 0; i < tempInit.length(); i++) {
			if (i + 1 != tempInit.length()) {
				if (tempInit.charAt(i) == '=' && tempInit.charAt(i + 1) == '=') {
					i++;
				}
			} else if (tempInit.charAt(i) == '(') {
				i++;
			}
			init += tempInit.charAt(i);
		}

		System.out.println(init + "init is ");
		String tempCond = getTranslatorBlockAtSocket(1).toCode();
		String cond = new String("");
		for (int i = 0; i < tempCond.length(); i++) {
			if (i + 1 != tempCond.length()) {
				if (tempCond.charAt(i) == '(') {
				i++;
			}
			cond += tempCond.charAt(i);
		}
		
		String step = getTranslatorBlockAtSocket(2).toCode();
		String var = new String("");
		for (int j = 0; j < init.length(); j++) {
			if (init.charAt(j) == '=') {
				break;
			}
			var += init.charAt(j);
		}
		step = var + "+=" + step;
		init = "float " + init;
		String execution = "";
		if (!isTranslatorBlockAtSocketNull(3)) {
			execution = getTranslatorBlockAtSocket(3).toCode();
		}
		init.replace("(", "");
		init.replace(")", "");
		cond.replace("(", "");
		cond.replace(")", "");
		step.replace("(", "");
		step.replace(")", "");
		String ret = "for(" + init + " ; " + cond + " ; " + step + " ){\n"
				+ execution + "\n}\n";
		System.out.println("ret is" + ret);
		return ret;

	}
}
